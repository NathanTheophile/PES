[gd_scene load_steps=12 format=2]

[ext_resource path="res://skills/Recursos Comuns/cell.png" type="Texture" id=1]
[ext_resource path="res://areas/cell.png" type="Texture" id=2]
[ext_resource path="res://glyph/Glyph.gd" type="Script" id=3]
[ext_resource path="res://skills/014 - Slime Meteor/Meteor.tscn" type="PackedScene" id=4]
[ext_resource path="res://skills/old/004 - earthquake/Dust.tscn" type="PackedScene" id=5]
[ext_resource path="res://glyph/001 - ground slime/(Glyph) Ground Slime.tscn" type="PackedScene" id=6]
[ext_resource path="res://states/old/004 - Stun/(State) Stun.tscn" type="PackedScene" id=7]
[ext_resource path="res://enemies/old/001-slime/(Enemy) Slime.tscn" type="PackedScene" id=8]
[ext_resource path="res://skills/old/002 - slime shot/SlimeShotProjectile.tscn" type="PackedScene" id=9]
[ext_resource path="res://skills/old/002 - slime shot/SlimeShotVisual.tscn" type="PackedScene" id=10]

[sub_resource type="GDScript" id=1]
script/source = "extends Node

var glyph
var turns 
var tree 
func setup():
	glyph = get_parent()
	tree = glyph.caster
	tree.connect(\"turn_start\",self,\"fall\")
	tree.connect(\"turn_end\",self,\"dead\")
	tree.connect(\"killed\",self,\"cancel\")

var shoot = false
func dead():
	if not shoot:
		shoot = true
	else:
		yield(get_tree(),\"idle_frame\")
		BattleMechanics.killEntity(tree, tree)

func cancel(_a):
	BattleMechanics.removeGlyph(glyph)

func fall():
	glyph.get_node(\"Slime\").visible = false
	BattleMechanics.yieldTurnStart += 2.3
	BattleMechanics.turnStartSkip = true
	BattleMechanics.playAnimEntity(tree, \"Throw\")
	
	yield(get_tree().create_timer(1),\"timeout\")
	
	
	var cells = BattleMechanics.getCellInRadius(glyph.posit, 3, false, 0)
	BattleMechanics.playAnim(glyph.extraStates[0], glyph.posit, false, \"over\")
	yield(get_tree().create_timer(0.2),\"timeout\")
	for i in cells.size():
		var tgt = BattleMechanics.getEntityAt(cells[i])
		if tgt:
			if tgt.player:
				BattleMechanics.dealDmg([30,\"e\"], tgt, tree)
		BattleMechanics.playAnim(glyph.extraStates[1],cells[i], false, \"ysort\")
		BattleMechanics.placeGlyph(glyph.extraStates[2], cells[i], tree)
	
	var cellsSummon = BattleMechanics.getCellInRadius(glyph.posit, 5, true, 4)
	for i in cellsSummon.size():
		throw(cellsSummon[i])
	
	yield(get_tree().create_timer(2),\"timeout\")
	
	BattleMechanics.removeGlyph(glyph)

func throw(posit):
	yield(BattleMechanics.shootProjectile(glyph.extraStates[6], glyph.posit, posit),\"completed\")
	BattleMechanics.summonMonster(glyph.extraStates[4],posit,tree,glyph.extraStates[3])
	BattleMechanics.playAnim(glyph.extraStates[5], posit, false, \"ysort\")
"

[node name="Node2D" type="Node2D"]
script = ExtResource( 3 )
id = 2
glyphName = "Slime Meteor"
effects = SubResource( 1 )
extraStates = [ ExtResource( 4 ), ExtResource( 5 ), ExtResource( 6 ), ExtResource( 7 ), ExtResource( 8 ), ExtResource( 10 ), ExtResource( 9 ) ]

[node name="Sprite" type="Sprite" parent="."]
visible = false
position = Vector2( 0, 21 )
texture = ExtResource( 2 )

[node name="Slime" type="Sprite" parent="."]
modulate = Color( 1, 1, 1, 0.811765 )
position = Vector2( -1, 20 )
texture = ExtResource( 1 )

[node name="Effects" type="Node" parent="."]
