[gd_scene load_steps=8 format=2]

[ext_resource path="res://Roboto-Bold.ttf" type="DynamicFontData" id=1]
[ext_resource path="res://characters/001 - Luffy/luffy.png" type="Texture" id=2]
[ext_resource path="res://states/StatePreview.tscn" type="PackedScene" id=3]
[ext_resource path="res://states/StateScript.gd" type="Script" id=4]
[ext_resource path="res://characters/001 - Luffy/(State) Well Fed.tscn" type="PackedScene" id=5]

[sub_resource type="GDScript" id=1]
script/source = "extends Node

var state
var luffy
func stateSetup():
	state = get_parent()
	luffy = state.get_node(\"../..\")
	BattleMechanics.connect(\"battleStart\",self,\"lunch\")
	BattleMechanics.connect(\"endEnemysTurn\",self,\"lunch\")
	luffy.connect(\"healed\",self,\"healproc\")
var cd = 0
func lunch():
	if cd == 0:
		lunchEffect()
		cd = 2
	else:
		cd -= 1
func lunchEffect():
	yield(get_tree(),\"idle_frame\")
	luffy.busy = true
	BattleMechanics.walkActive = true
	BattleMechanics.skillActive = true
	
	AM.play(luffy.audioEX[2], {\"randp\": true})
	BattleMechanics.playAnimEntity(luffy, \"Lunch\")

	AM.play(luffy.audioEX[1], {\"randp\": true, \"pitch\": 1.6})
	yield(get_tree().create_timer(0.85),\"timeout\")
	AM.play(luffy.audioEX[5], {\"randp\": true})
	var val = round(float(luffy.hp) * 0.3)
	
	BattleMechanics.heal(val,luffy,luffy)
	for i in 4:
		yield(get_tree().create_timer(0.1),\"timeout\")
		AM.play(luffy.audioEX[7], {\"randp\": 1.8})
		

	AM.play(luffy.audioEX[6], {\"randp\": true})

	
	BattleMechanics.walkActive = false
	BattleMechanics.skillActive = false
	luffy.busy = false
func healproc(heal, _h, before):
	if before:
		if luffy.hp_loss < heal:
			var over = round(100 * (heal - luffy.hp_loss) / luffy.hp)
			BattleMechanics.addState(state.extraStates[0],luffy,luffy,over)
	
"

[sub_resource type="DynamicFont" id=2]
outline_size = 3
outline_color = Color( 0.215686, 0.215686, 0.215686, 1 )
font_data = ExtResource( 1 )

[node name="State" type="Node2D"]
z_as_relative = false
script = ExtResource( 4 )
stateName = "Monkey D. Luffy"
description = "Luffy eats and heals by [b]30% of max HP[/b] on the start of every 3rd round, starting on the 1st.

When he overheals, gets [b]Stuffed[/b]:
- 1 Lvl per 1% of overheal."
type = 3
effects = SubResource( 1 )
extraStates = [ ExtResource( 5 ) ]
appearOver = true
maxStack = 1

[node name="Effects" type="Node" parent="."]

[node name="Icon" type="TextureRect" parent="."]
visible = false
margin_right = 32.0
margin_bottom = 32.0
mouse_filter = 0
texture = ExtResource( 2 )
stretch_mode = 6

[node name="LVl" type="Label" parent="Icon"]
margin_left = 21.0
margin_top = 17.0
margin_right = 30.0
margin_bottom = 36.0
grow_horizontal = 2
custom_fonts/font = SubResource( 2 )
text = "1"
align = 1
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Window" type="Node2D" parent="Icon"]

[node name="Panel" parent="Icon/Window" instance=ExtResource( 3 )]
visible = false
margin_left = 32.0
margin_top = -60.0
margin_right = 238.0
margin_bottom = -7.0
