[gd_scene load_steps=6 format=2]

[ext_resource path="res://skills/SkillScript.gd" type="Script" id=1]
[ext_resource path="res://characters/001 - Luffy/skills/anim_slash.tscn" type="PackedScene" id=2]
[ext_resource path="res://skills/HelperWindows/Push.tscn" type="PackedScene" id=3]
[ext_resource path="res://areas/01 - Alvida/enemies/Alvida/(Glyph) Target.tscn" type="PackedScene" id=4]

[sub_resource type="GDScript" id=1]
script/source = "extends Node

# targetArray = Array contendo as posições que esse feitiço atingiu
#               A célula central será contida em um Array sozinha, para fácil identificação
var skill
func effects(targetArray):
	skill = get_parent()

	BattleMechanics.playAnimEntity(skill.caster, \"Point\")
	
	yield(get_tree().create_timer(0.6),\"timeout\")
	var phase = BattleMechanics.getState(skill.caster,\"Phases\").lvl
	var used = []
	for i in phase:
		
		var p = []
		for j in BattleMechanics.area.entities.get_children():
			if j.player:
				p.append(j)
		
		randomize()
		var randP = BattleMechanics.getRandPlayer()
		var randCell = BattleMechanics.getCellInRadius(randP.posit, 2)
		while BattleMechanics.distanceTo(randCell,skill.caster.posit)<=2:
			randCell = BattleMechanics.getCellInRadius(randP.posit, 2)
		used.append(randCell)
		BattleMechanics.placeGlyph(skill.states[0],randCell,skill.caster)
		yield(get_tree().create_timer(0.1),\"timeout\")
	for i in phase:
		var p = []
		for j in BattleMechanics.area.entities.get_children():
			if j.player:
				p.append(j)
		
		randomize()
		var randP = BattleMechanics.getRandPlayer()
		var randCell = BattleMechanics.getCellInRadius(randP.posit, 4,true,1,[],3)
		while BattleMechanics.distanceTo(randCell,skill.caster.posit)<=2:
			randCell = BattleMechanics.getCellInRadius(randP.posit, 4,true,1,[],3)
		used.append(randCell)
		BattleMechanics.placeGlyph(skill.states[0],randCell,skill.caster)
		yield(get_tree().create_timer(0.1),\"timeout\")
			
	
	
	
"

[node name="Skill" type="Node2D"]
script = ExtResource( 1 )
skillName = "Raining Cannonballs"
rangeMin = 0
rangeMax = 0
linear = true
sight = true
usePerTurn = 1
visuals = [ ExtResource( 2 ) ]
effects = SubResource( 1 )
states = [ ExtResource( 4 ) ]
helpertext = [ ExtResource( 3 ) ]

[node name="Effects" type="Node" parent="."]
